ä»¥ä¸‹æ˜¯æ€»ç»“çš„ **Markdown** ç‰ˆæœ¬ï¼š

---

# **`synchronized` åœ¨ `setRealData()` å’Œ `getContent()` ä¹‹é—´çš„çº¿ç¨‹é€šä¿¡**

## **1. `getContent()` æ–¹æ³•ï¼šç­‰å¾…æ•°æ®å‡†å¤‡**
```java
@Override
public synchronized String getContent() {
    while (!isReady) {  // å¦‚æœæ•°æ®æœªå‡†å¤‡å¥½
        try {
            wait();  // è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œé‡Šæ”¾é”
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
    return realData.getContent(); // æ•°æ®å‡†å¤‡å¥½åè¿”å›å†…å®¹
}
```
### **ä½œç”¨**
- å¦‚æœ `isReady == false`ï¼Œè¡¨ç¤º `realData` è¿˜æœªå‡†å¤‡å¥½ã€‚
- çº¿ç¨‹ **è°ƒç”¨ `wait()` è¿›å…¥ç­‰å¾…çŠ¶æ€**ï¼Œå¹¶ **é‡Šæ”¾ `synchronized` é”**ï¼Œè®©å…¶ä»–çº¿ç¨‹ï¼ˆå¦‚ `setRealData()`ï¼‰æ‰§è¡Œã€‚

---

## **2. `setRealData()` æ–¹æ³•ï¼šé€šçŸ¥æ•°æ®å·²å‡†å¤‡å¥½**
```java
public synchronized void setRealData(RealData realData) {
    if (isReady) {  // é¿å…é‡å¤è®¾ç½®
        return;
    }
    this.realData = realData;
    this.isReady = true;
    notifyAll(); // å”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹
}
```
### **ä½œç”¨**
- **è®¾ç½® `realData` å¹¶å°† `isReady` ç½®ä¸º `true`**ï¼Œè¡¨ç¤ºæ•°æ®å·²å‡†å¤‡å¥½ã€‚
- **è°ƒç”¨ `notifyAll()` å”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹**ï¼Œè®© `getContent()` ç»§ç»­æ‰§è¡Œã€‚

---

## **3. çº¿ç¨‹é€šä¿¡è¿‡ç¨‹**
1. `getContent()` çº¿ç¨‹æ‰§è¡Œï¼Œå‘ç° `isReady == false`ï¼Œè°ƒç”¨ `wait()` è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œå¹¶ **é‡Šæ”¾é”**ã€‚
2. `Host` å†…éƒ¨çº¿ç¨‹è°ƒç”¨ `setRealData()`ï¼š
    - **è·å–é”**ï¼Œè®¾ç½® `realData`ï¼Œå°† `isReady` è®¾ä¸º `true`ã€‚
    - è°ƒç”¨ `notifyAll()` å”¤é†’ **æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹**ã€‚
3. `getContent()` çº¿ç¨‹è¢«å”¤é†’ï¼Œ**é‡æ–°è·å–é”** å¹¶ç»§ç»­æ‰§è¡Œï¼Œè¿”å› `realData.getContent()`ã€‚

---

## **4. ä¸ºä»€ä¹ˆä½¿ç”¨ `while (!isReady)` è€Œä¸æ˜¯ `if (!isReady)`ï¼Ÿ**
```java
while (!isReady) {
    wait();
}
```
### **åŸå› **
- `wait()` å¯èƒ½è¢« **è™šå‡å”¤é†’ï¼ˆspurious wakeupï¼‰**ï¼Œå³çº¿ç¨‹å¯èƒ½è¢«æ„å¤–å”¤é†’ä½† `isReady` ä»ä¸º `false`ã€‚
- `while` ç»“æ„**ç¡®ä¿çº¿ç¨‹è¢«å”¤é†’åä¼šå†æ¬¡æ£€æŸ¥æ¡ä»¶**ï¼Œé¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚

---

## **5. å…³é”®ç‚¹æ€»ç»“**
- `synchronized` **ä¿è¯** `setRealData()` å’Œ `getContent()` æ–¹æ³•çš„**äº’æ–¥è®¿é—®**ã€‚
- `wait()` **ä½¿çº¿ç¨‹é‡Šæ”¾é”**ï¼Œå¹¶ç­‰å¾… `notifyAll()` å”¤é†’ã€‚
- `notifyAll()` **å”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹**ï¼Œè®© `getContent()` ç»§ç»­æ‰§è¡Œã€‚
- `while (!isReady) wait();` **é¿å…è™šå‡å”¤é†’é—®é¢˜**ï¼Œç¡®ä¿ `realData` çœŸçš„å‡†å¤‡å¥½ã€‚

---

## **6. ç°å®åœºæ™¯ç±»æ¯”**
å¯ä»¥æŠŠ `FutureData` çœ‹ä½œ **å¤–å–è®¢å•**ï¼š
- **`getContent()`ï¼ˆé¡¾å®¢ï¼‰**ï¼šæŸ¥è¯¢å¤–å–æ˜¯å¦é€è¾¾ï¼Œå¦‚æœè¿˜æ²¡é€è¾¾ï¼ˆ`!isReady`ï¼‰ï¼Œé¡¾å®¢å°±è¿›å…¥ **ç­‰å¾…çŠ¶æ€ï¼ˆwaitï¼‰**ã€‚
- **`setRealData()`ï¼ˆå¤–å–å‘˜ï¼‰**ï¼šé€è¾¾å¤–å–ï¼Œæ ‡è®° **å¤–å–å·²åˆ°ï¼ˆisReady = trueï¼‰**ï¼Œç„¶å **é€šçŸ¥é¡¾å®¢ï¼ˆnotifyAllï¼‰**ã€‚
- **`getContent()` è¢«å”¤é†’**ï¼Œé¡¾å®¢è·å–å¤–å–æ•°æ®ã€‚

è¿™ç§æ¨¡å¼æ˜¯ **å…¸å‹çš„ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ï¼ˆProducer-Consumerï¼‰**ï¼Œç”¨äºå¼‚æ­¥æ•°æ®çš„è·å–ã€‚ğŸš€

æ˜¯çš„ï¼Œ**`FutureData` å¯ä»¥ç±»æ¯”ä¸º "æè´§å•"ï¼ˆæ”¶æ®ï¼‰**ï¼Œè¿™ä¸€ç±»æ¯”èƒ½æ›´æ¸…æ¥šåœ°è§£é‡Š `Future` æ¨¡å¼çš„å·¥ä½œåŸç†ã€‚

---

## **ç±»æ¯”è¯´æ˜**
å‡è®¾ä½ åœ¨æŸä¸ªå•†åº—è®¢è´­äº†ä¸€ä»¶å•†å“ï¼š
1. **ä½ ä¸‹å•åï¼Œåº—å‘˜ä¸ä¼šç«‹å³ç»™ä½ å•†å“ï¼Œè€Œæ˜¯ç»™ä½ ä¸€å¼  "æè´§å•"ï¼ˆFutureDataï¼‰ã€‚**
2. **åº—å‘˜å¼€å§‹å‡†å¤‡å•†å“**ï¼ˆå¼‚æ­¥å¤„ç† `RealData`ï¼‰ã€‚
3. **ä½ å¯ä»¥å…ˆå»åšå…¶ä»–äº‹æƒ…ï¼Œè€Œä¸æ˜¯å¹²ç­‰**ï¼ˆéé˜»å¡è¿”å› `FutureData`ï¼‰ã€‚
4. **ç­‰å•†å“å‡†å¤‡å¥½åï¼Œåº—å‘˜ä¼šé€šçŸ¥ä½ å¯ä»¥æ¥é¢†å–**ï¼ˆ`setRealData()` + `notifyAll()`ï¼‰ã€‚
5. **ä½ æ‹¿ç€ "æè´§å•" æ¥å–è´§**ï¼ˆ`getContent()`ï¼‰ã€‚
6. **å¦‚æœå•†å“è¿˜æ²¡å‡†å¤‡å¥½ï¼Œä½ å°±éœ€è¦ç­‰å¾…**ï¼ˆ`wait()` æœºåˆ¶ï¼‰ã€‚

---

## **å¯¹æ¯” `FutureData` æœºåˆ¶**
| **ç°å®åœºæ™¯** | **FutureData å®ç°** |
|-------------|------------------|
| é¡¾å®¢ä¸‹å•ï¼Œåº—å‘˜ç»™ "æè´§å•" | `Host.request()` è¿”å› `FutureData` |
| åº—å‘˜åå°å‡†å¤‡å•†å“ | `new Thread(() -> new RealData())` |
| é¡¾å®¢å¯ä»¥å»åšåˆ«çš„äº‹ | `FutureData` ç«‹å³è¿”å›ï¼Œä¸»çº¿ç¨‹å¯æ‰§è¡Œå…¶ä»–ä»»åŠ¡ |
| å•†å“å‡†å¤‡å¥½ï¼Œåº—å‘˜é€šçŸ¥ | `setRealData()` + `notifyAll()` |
| é¡¾å®¢æ‹¿ç€æè´§å•å–è´§ | `getContent()` è·å– `RealData` |
| å¦‚æœå•†å“è¿˜æ²¡å¥½ï¼Œé¡¾å®¢éœ€ç­‰å¾… | `getContent()` è°ƒç”¨ `wait()` |

---

## **ä¸ºä»€ä¹ˆ FutureData é€‚åˆè¿™æ ·çš„ç±»æ¯”ï¼Ÿ**
1. **æè´§å•è¡¨ç¤º "å ä½ç¬¦"**ï¼Œæœªæ¥ä¼šæœ‰çœŸå®æ•°æ®ï¼ˆ`RealData`ï¼‰ã€‚
2. **è·å–çœŸå®æ•°æ®éœ€è¦ç­‰å¾…**ï¼Œä½†å¯ä»¥å…ˆåšåˆ«çš„äº‹ï¼ˆ`FutureData` ç«‹å³è¿”å›ï¼‰ã€‚
3. **ç­‰æ•°æ®å‡†å¤‡å¥½åï¼Œæ‰çœŸæ­£è¿”å›ç»“æœ**ï¼ˆ`setRealData()` é€šçŸ¥ `getContent()`ï¼‰ã€‚

è¿™ä¸ªç±»æ¯”å¸®åŠ©æ›´å¥½åœ°ç†è§£ `Future` æ¨¡å¼åœ¨å¼‚æ­¥ç¼–ç¨‹ä¸­çš„åº”ç”¨ï¼ğŸš€


æ˜¯çš„ï¼Œ**å¯¹è±¡é”æŒ‡çš„æ˜¯ `FutureData` çš„å®ä¾‹å¯¹è±¡é”**ã€‚

åœ¨ `FutureData` ç±»ä¸­ï¼Œ`setRealData()` å’Œ `getContent()` æ–¹æ³•éƒ½è¢« `synchronized` å…³é”®å­—ä¿®é¥°ï¼Œè¿™æ„å‘³ç€å®ƒä»¬çš„**åŒæ­¥é”æ˜¯ `FutureData` å®ä¾‹å¯¹è±¡**ã€‚

---

## **å¯¹è±¡é”è§£æ**
```java
public class FutureData implements Data {
    private RealData realData;
    private boolean isReady = false;

    @Override
    public synchronized String getContent() {  // (1) åŠ é”ï¼šé”ä½ thisï¼ˆå³ FutureData å®ä¾‹ï¼‰
        while (!isReady) {
            try {
                wait();  // (2) é‡Šæ”¾ this é”ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
        return realData.getContent();  // (5) æ•°æ®å°±ç»ªåè¿”å›
    }

    public synchronized void setRealData(RealData realData) {  // (3) åŠ é”ï¼šé”ä½ thisï¼ˆå³ FutureData å®ä¾‹ï¼‰
        if (isReady) {
            return;
        }
        this.realData = realData;
        this.isReady = true;
        notifyAll();  // (4) å”¤é†’ getContent() çº¿ç¨‹
    }
}
```

---

## **çº¿ç¨‹åŒæ­¥è¿‡ç¨‹**
1. `Main` çº¿ç¨‹è°ƒç”¨ `getContent()`ï¼Œå‘ç° `isReady == false`ï¼Œäºæ˜¯ï¼š
    - **è¿›å…¥ `synchronized` ä»£ç å—**ï¼Œè·å– `FutureData` å¯¹è±¡é”ã€‚
    - **è°ƒç”¨ `wait()`ï¼Œé‡Šæ”¾ `FutureData` çš„å¯¹è±¡é”**ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚
2. `Host` çº¿ç¨‹ï¼ˆæˆ–è€…åå°çº¿ç¨‹ï¼‰è°ƒç”¨ `setRealData()`ï¼š
    - **è¿›å…¥ `synchronized` ä»£ç å—**ï¼Œè·å– `FutureData` çš„å¯¹è±¡é”ã€‚
    - è®¾ç½® `realData` å¹¶å°† `isReady` è®¾ä¸º `true`ã€‚
    - è°ƒç”¨ `notifyAll()`ï¼Œ**å”¤é†’ `getContent()` çº¿ç¨‹**ã€‚
3. `getContent()` çº¿ç¨‹è¢«å”¤é†’åï¼š
    - **é‡æ–°ç«äº‰ `FutureData` çš„å¯¹è±¡é”**ï¼ˆå› ä¸º `wait()` é‡Šæ”¾äº†é”ï¼‰ã€‚
    - é‡æ–°æ£€æŸ¥ `isReady`ï¼Œå‘ç° `true`ï¼Œè¿”å› `realData.getContent()`ã€‚

---

## **æ€»ç»“**
- `synchronized` ä¿®é¥°çš„æ–¹æ³•ä¼š**é”ä½ `this`ï¼Œå³ `FutureData` çš„å¯¹è±¡é”**ã€‚
- `wait()` è®©çº¿ç¨‹ **é‡Šæ”¾ `FutureData` å¯¹è±¡é”** å¹¶è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚
- `setRealData()` æ‹¿åˆ°é”ï¼Œè®¾ç½®æ•°æ®ï¼Œ**è°ƒç”¨ `notifyAll()` å”¤é†’ `getContent()` çº¿ç¨‹**ã€‚
- `getContent()` çº¿ç¨‹è¢«å”¤é†’åï¼Œ**é‡æ–°ç«äº‰ `FutureData` çš„å¯¹è±¡é”**ï¼Œè·å–æ•°æ®ã€‚

---

### **ğŸ” é‡ç‚¹**
âœ” **å¯¹è±¡é”æ˜¯ `FutureData` å®ä¾‹**ï¼Œå³ `this`ã€‚  
âœ” `wait()` é‡Šæ”¾ `FutureData` çš„å¯¹è±¡é”ï¼Œè®© `setRealData()` çº¿ç¨‹æ‰§è¡Œã€‚  
âœ” `notifyAll()` å”¤é†’ç­‰å¾…çš„çº¿ç¨‹ï¼Œç¡®ä¿æ•°æ®å¯ä»¥è¢«è¯»å–ã€‚

è¿™æ ·å°±å®ç°äº†**å¼‚æ­¥è·å–æ•°æ®çš„çº¿ç¨‹é€šä¿¡**ï¼ğŸš€